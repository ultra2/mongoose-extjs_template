/*
Copyright(c) 2011 Company Name
*/
Ext.define("NAT.automenuitem.Abstract",{extend:"Ext.menu.Item"});Ext.define("NAT.automenuitem.AutoPanel",{extend:"NAT.automenuitem.Abstract",alias:"widget.natautopanelmenuitem",autopanel:"",initComponent:function(){this.callParent(arguments);this.on("click",this.this_click,this)},this_click:function(){viewport.showAutoPanel(this.autopanel)}});Ext.define("NAT.autopanel.Abstract",{extend:"Ext.panel.Panel",refresh:function(c,b,a){Ext.callback(b,a,[null,null],1)},refreshUI:function(a){}});Ext.define("NAT.autopanel.Grid",{extend:"NAT.autopanel.Abstract",alias:"widget.natgridautopanel",model:"",store:null,constructor:function(a){if(!this.designMode){this.store=Ext.create("NAT.data.Store",{collection:this.model})}this.callParent([a])},initComponent:function(){this.callParent(arguments);if(this.designMode){return}this.down("#gridMain").BindStore(this.store);this.down("#gridMain").on("select",this.gridMain_select,this);this.down("#btnNew").on("click",this.btnNew_click,this);this.down("#btnDelete").on("click",this.btnDelete_click,this);this.down("#btnSave").on("click",this.btnSave_click,this);this.down("#btnCancel").on("click",this.btnCancel_click,this)},gridMain_select:function(){this.refreshToolbar()},btnNew_click:function(){if(!this.model){return}var a=app.natCreateModel(this.model);a.endEdit();this.store.add(a)},btnDelete_click:function(){var a=this.down("#gridMain").getSelected();this.store.remove(a)},btnSave_click:function(){var a=this;async.waterfall([function(b){a.save(null,b,a)},function(c,b){a.refreshUI(null);viewport.refresh(null,b,a)}])},btnCancel_click:function(){this.reject();this.refreshUI(null)},save:function(c,b,a){this.store.Save(c,b,a)},reject:function(){this.store.reject()},refresh:function(c,b,a){this.store.Load(c,b,a)},refreshUI:function(a){this.refreshToolbar()},refreshToolbar:function(){var b=this.down("#gridMain");var a=b.getSelected();this.down("#btnDelete").setDisabled(!a)}});Ext.define("NAT.autopanel.Tree",{extend:"NAT.autopanel.Abstract",alias:"widget.nattreeautopanel",model:"",store:null,constructor:function(a){if(!this.designMode){this.store=Ext.create("NAT.data.TreeStore",{collection:this.model})}this.callParent([a])},initComponent:function(){this.callParent(arguments);if(this.designMode){return}this.down("#treeMain").BindStore(this.store);this.down("#treeMain").on("select",this.treeMain_select,this);this.down("#btnNew").on("click",this.btnNew_click,this);this.down("#btnDelete").on("click",this.btnDelete_click,this);this.down("#btnSave").on("click",this.btnSave_click,this);this.down("#btnCancel").on("click",this.btnCancel_click,this);this.down("#btnExpandAll").on("click",this.btnExpandAll,this)},treeMain_select:function(){this.refreshToolbar()},btnNew_click:function(){if(!this.model){return}var a=this.down("#treeMain");var b=this;async.waterfall([function(c){b.ensureRoot(null,c,b)},function(d,c){var f=a.getSelected()||b.store.getRootNode();var e=app.natCreateModel(b.model);e.set("loaded",true);e.endEdit();f.appendChild(e);b.saveRefresh(null,c,b)}])},btnDelete_click:function(){this.down("#treeMain").getSelected().remove();this.saveRefresh(null,null,this)},btnSave_click:function(){this.saveRefresh(null,null,this)},btnCancel_click:function(){this.reject();this.refreshUI(null)},btnExpandAll:function(){this.down("#treeMain").expandAll(null,this)},ensureRoot:function(d,c,b){if(this.store.getRootNode()){Ext.callback(c,b,[null,null],0);return}var a=app.natCreateModel(this.model);a.set("name","root");a.set("loaded",true);a.endEdit();this.store.setRootNode(a);this.saveRefresh(null,c,b)},reject:function(){this.store.reject()},saveRefresh:function(d,c,a){var b=this;async.waterfall([function(e){b.save(null,e,b)},function(f,e){viewport.refresh(null,e,b)}],function(e,f){Ext.callback(c,a,[e,null],0)})},save:function(c,b,a){this.store.Save(c,b,a)},refresh:function(c,b,a){this.store.Load(c,b,a)},refreshUI:function(a){this.refreshToolbar()},refreshToolbar:function(){var a=this.down("#treeMain");var b=a.getSelected();this.down("#btnDelete").setDisabled(!b)}});Ext.define("NAT.autoviewport.Abstract",{extend:"Ext.container.Viewport"});Ext.define("NAT.autoviewport.Tabbed",{extend:"NAT.autoviewport.Abstract",alias:"widget.nattabbedautoviewport",initComponent:function(){this.callParent(arguments);this.down("#btnRefresh").on("click",this.btnRefresh_click,this)},showAutoPanel:function(b){b=Ext.create("widget."+b);var a=this.down("#tpMain");a.add(b);a.setActiveTab(b);b.refresh(null,null,this)},btnRefresh_click:function(){this.refresh(null,null,this)},refresh:function(d,c,a){var b=this;async.parallel([function(e){var f=b.down("#tpMain");async.forEach(f.items.getRange(),function(h,g){h.refresh(null,g,b)},e)}],function(e,f){b.refreshUI(d);Ext.callback(c,a,[e,null],1)})},refreshUI:function(a){}});Ext.define("NAT.button.Button",{extend:"Ext.button.Button",alias:"widget.natbutton",autoWidth:true,initComponent:function(){this.callParent(arguments)}});Ext.define("NAT.tree.plugin.CellEditing",{alias:"plugin.nattreecellediting",extend:"Ext.grid.plugin.CellEditing",getEditingContext:function(e,c){var f=this,a=f.grid,j=a.store,b,d,h=a.getView(),g=a.getRootNode(),i;if(Ext.isNumber(e)){b=e;e=j.tree.flatten()[b]}else{b=g.indexOfId(e._id)}if(Ext.isNumber(c)){d=c;c=a.headerCt.getHeaderAtIndex(d)}else{d=c.getIndex()}i=e.get(c.dataIndex);return{grid:a,record:e,field:c.dataIndex,value:i,row:h.getNode(b),column:c,rowIdx:b,colIdx:d}}});Ext.define("NAT.edit.Source",{extend:"Ext.panel.Panel",alias:"widget.natsourceedit",layout:"fit",border:false,isFormField:true,propertyPath:"",parser:"javascript",readOnly:false,firstRowReadonly:false,lastRowReadonly:false,path:"",sourceCode:"",fontSize:"18px",theme:"textmate",printMargin:false,highlightActiveLine:true,tabSize:4,useSoftTabs:false,showInvisible:false,useWrapMode:false,initEditor:function(){var a=this;a.editor=ace.edit(a.editorId);a.setMode(a.parser);a.setTheme(a.theme);a.editor.getSession().setUseWrapMode(a.useWrapMode);a.editor.setShowInvisibles(a.showInvisible);a.setFontSize(a.fontSize);a.editor.setShowPrintMargin(a.printMargin);a.editor.setHighlightActiveLine(a.highlightActiveLine);a.getSession().setTabSize(a.tabSize);a.getSession().setUseSoftTabs(a.useSoftTabs);a.setValue(a.sourceCode);a.editor.setReadOnly(a.readOnly);a.editor.container.addEventListener("keydown",function(d){var f=a.readOnly;var c=a.getLength();var b=a.editor.getCursorPosition();if((a.firstRowReadonly)&&(b.row==0)){f=true}if((a.lastRowReadonly)&&(b.row==c-1)){f=true}a.editor.setReadOnly(f)},true);a.editor.getSession().on("change",function(){if(a.readOnly===true){return}a.fireEvent("change",a,a.getValue())},a);a.editor.focus()},getEditor:function(){return this.editor},getSession:function(){return this.editor.getSession()},getTheme:function(){return this.editor.getTheme()},getLength:function(){return this.editor.getSession().getLength()},getAllLines:function(){return this.editor.getSession().getLines(0,this.getLength())},setTheme:function(a){this.editor.setTheme("ace/theme/"+a)},setMode:function(a){this.getSession().setMode("ace/mode/"+a)},getValue:function(){if(!this.editor){return}return this.editor.getSession().getValue()},setValue:function(b){if(Ext.isArray(b)){b={array:b}}if(Ext.isObject(b)){try{b=JSON.stringify(b,null,"\t")}catch(a){alert("Incorrect config "+this.get("name")+" \n error: "+a);return}}if(!this.editor){this.sourceCode=b;return}this.editor.getSession().setValue(b)},setFontSize:function(a){this.editor.setFontSize(a)},setReadOnly:function(a){if(!this.editor){this.readOnly=a;return}this.editor.setReadOnly(a)},undo:function(){this.editor.undo()},redo:function(){this.editor.redo()},listeners:{resize:function(){if(this.editor){this.editor.resize()}},activate:function(){if(this.editor){this.setValue(this.getValue());this.editor.focus()}}},initComponent:function(){var b=this,a={xtype:"component",autoEl:"pre"};b.addEvents("change");if(b.contentEl!=null){b.sourceCode=Ext.get(b.contentEl).dom.innerHTML}Ext.apply(b,{items:a});b.callParent(arguments)},onRender:function(){var a=this;if(a.contentEl!=null){a.sourceCode=Ext.get(a.contentEl).dom.innerHTML}a.editorId=a.items.keys[0];a.oldSourceCode=a.sourceCode;a.callParent(arguments);a.on("afterlayout",function(){if(a.url){Ext.Ajax.request({url:a.url,success:function(b){a.sourceCode=b.responseText;a.initEditor()}})}else{a.initEditor()}},a,{single:true})},isValid:function(){return true},isDirty:function(){return false}});Ext.define("NAT.edit.StringArray",{extend:"Ext.form.FieldContainer",alias:"widget.natstringarrayedit",mixins:{bindable:"Ext.util.Bindable",field:"Ext.form.field.Field"},requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:{type:"vbox",align:"stretch"},propertyPath:"",itemRenderer:null,valueField:"id",displayField:"name",ddReorder:false,appendOnly:false,allowBlank:true,ignoreSelectChange:0,constructor:function(a){this.store=Ext.create("Ext.data.ArrayStore",{fields:["id","name"],data:[]});this.callParent([a])},initComponent:function(){var a=this;a.bindStore(a.store,true);a.items=[{xtype:"container",dock:"top",cls:"commandbar",defaults:{margins:2},layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",itemId:"cbAvailableTypes",editable:false,flex:1,valueField:"id",displayField:"name"},{xtype:"natbutton",itemId:"btnAddType",icon:"https://extsolutions.herokuapp.com/graphics/Momentum_MatteEntireSet1/16/add.png",tooltip:"Add type"},{xtype:"natbutton",itemId:"btnRemoveType",icon:"https://extsolutions.herokuapp.com/graphics/Momentum_MatteEntireSet1/16/delete.png",tooltip:"Remove type"}]},{xtype:"boundlist",itemId:"blItems",flex:1,deferInitialRefresh:false,border:1,multiSelect:false,store:a.store,displayField:a.displayField,disabled:a.disabled}];a.callParent();a.initField();a.addEvents("drop");a.down("#cbAvailableTypes").on("select",this.cbAvailableTypes_select,this);a.down("#blItems").on("select",this.blItems_select,this);a.down("#btnAddType").on("click",this.btnAddType_click,this);a.down("#btnRemoveType").on("click",this.btnRemoveType_click,this)},setItemsStore:function(a){this.itemsStore=a},setComboStore:function(a){this.down("#cbAvailableTypes").bindStore(a)},cbAvailableTypes_select:function(){this.RefreshUI()},blItems_select:function(a,b){this.RefreshUI()},btnAddType_click:function(){var a=this.down("#cbAvailableTypes").getValue();var b=this.getValue();var c=Ext.Array.clone(b);c.push(a);this.setValue(c);this.fireEvent("itemchanged",c)},btnRemoveType_click:function(){var b=this.getSelected();var a=this.getValue();var c=Ext.Array.clone(a);Ext.Array.remove(c,b.getId());this.setValue(c);this.fireEvent("itemchanged",c)},getSelected:function(){var a=this.down("#blItems").getSelectionModel().getSelection();return(a)?a[0]:null},isEqual:function(e,d){var b=Ext.Array.from,c=0,a;e=b(e);d=b(d);a=e.length;if(a!==d.length){return false}for(;c<a;c++){if(d[c]!==e[c]){return false}}return true},afterRender:function(){var b=this,a;b.callParent();if(b.ddReorder&&!b.dragGroup&&!b.dropGroup){b.dragGroup=b.dropGroup="MultiselectDD-"+Ext.id()}if(b.draggable||b.dragGroup){b.dragZone=Ext.create("Ext.view.DragZone",{view:b.boundList,ddGroup:b.dragGroup,dragText:"{0} Item{1}"})}if(b.droppable||b.dropGroup){b.dropZone=Ext.create("Ext.view.DropZone",{view:b.boundList,ddGroup:b.dropGroup,handleNodeDrop:function(i,h,c){var d=this.view,f=d.getStore(),e=i.records,g;i.view.store.remove(e);g=f.indexOf(h);if(c==="after"){g++}f.insert(g,e);d.getSelectionModel().select(e);b.fireEvent("drop",b,e)}})}},isValid:function(){var b=this,a=b.disabled,c=b.forceValidation||!a;return c?b.validateValue(b.value):a},validateValue:function(b){var a=this,d=a.getErrors(b),c=Ext.isEmpty(d);if(!a.preventMark){if(c){a.clearInvalid()}else{a.markInvalid(d)}}return c},markInvalid:function(c){var b=this,a=b.getActiveError();b.setActiveErrors(Ext.Array.from(c));if(a!==b.getActiveError()){b.updateLayout()}},clearInvalid:function(){var b=this,a=b.hasActiveError();b.unsetActiveError();if(a){b.updateLayout()}},getValue:function(){return this.value||[]},setValue:function(a){this.mixins.field.setValue.call(this,a);this.updateItems()},updateItems:function(){this.store.removeAll();if(Ext.isArray(this.value)){for(var a=0;this.value.length>a;a++){this.store.add({id:this.value[a],name:(this.itemRenderer)?this.itemRenderer(this.value[a]):this.value[a]})}}},clearValue:function(){this.setValue([])},onEnable:function(){var a=this.boundList;this.callParent();if(a){a.enable()}},onDisable:function(){var a=this.boundList;this.callParent();if(a){a.disable()}},getErrors:function(a){return[]},onDestroy:function(){var a=this;a.bindStore(null);Ext.destroy(a.dragZone,a.dropZone);a.callParent()},onBindStore:function(a){var b=this.boundList;if(b){b.bindStore(a)}},RefreshUI:function(){var a=this.down("#cbAvailableTypes").getValue();var b=this.getSelected();this.down("#btnAddType").setDisabled(!a);this.down("#btnRemoveType").setDisabled(!b)}});Ext.define("NAT.form.field.Checkbox",{extend:"Ext.form.field.Checkbox",alias:"widget.natcheckboxfield",propertyPath:""});Ext.define("NAT.form.field.ComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.natcombobox",propertyPath:"",valueField:"id",displayField:"name",editable:false,selectOnFocus:true,typeAhead:true,emptyText:"Please choose!",triggerAction:"none",matchFieldWidth:true,queryMode:"local",listConfig:{loadMask:false,width:400},constructor:function(a){this.store=Ext.create("Ext.data.ArrayStore",{fields:["id","name"],data:[]});if(a.comboData){this.setComboData(a.comboData)}this.callParent([a])},initComponent:function(){this.callParent(arguments);this.on("beforequery",this.this_beforequery,this)},setComboData:function(e){this.store.removeAll();var d=[],f,a;if(Ext.isArray(e[0])){d=e}else{for(var b=0;e.length>b;b++){f=e[b];a=e[b];try{f=JSON.parse(f)}catch(c){}d.push([f,a])}}this.store.add(d)},renderer:function(b,c){if(!this.store){return b}var a=this.store.getById(b);if(!a){return b}return a.get(this.displayField)},this_beforequery:function(){this.expand();return false},BindStore:function(a){this.bindStore(a)}});Ext.define("NAT.form.field.Date",{extend:"Ext.form.field.Date",alias:"widget.natdatefield",propertyPath:""});Ext.define("NAT.form.field.Display",{extend:"Ext.form.field.Display",alias:"widget.natdisplayfield",propertyPath:""});Ext.define("NAT.form.field.File",{extend:"Ext.form.field.File",alias:"widget.natfilefield",propertyPath:""});Ext.define("NAT.form.field.Function",{extend:"Ext.form.field.Trigger",alias:"widget.natfunctionfield",requires:["NAT.edit.Source"],propertyPath:"",editable:false,functionName:"",functionParams:[],editorWindow:null,initComponent:function(){this.callParent(arguments)},onTriggerClick:function(){this.editorWindow=this.createEditor();this.editorWindow.show(null,function(d,c){this.onExpand()},this);this.editorWindow.center()},onExpand:function(){var b=this.getValue();var e=this.editorWindow.down("#sourceedit");if(b){var f=b.params;var a=b.body}else{f=this.functionParams;a="{\n\n}"}var d="function "+this.functionName+"(";if(f){for(var c=0;f.length>c;c++){d+=f[c];if(c<f.length-1){d+=", "}}}d+=")\n";d+=Ext.Array.convertToString(a,true);e.setValue(d);e.focus(false,1)},createEditor:function(){var a=this;return Ext.create("widget.natwindow",{title:"Function Editor",modal:true,height:600,width:1200,layout:{type:"vbox",align:"stretch"},items:[{xtype:"natsourceedit",itemId:"sourceedit",grow:true,fieldStyle:"border: none; background-image: none;",firstRowReadonly:true,lastRowReadonly:true,flex:1},{xtype:"container",layout:{type:"hbox",padding:"5",pack:"end",align:"middle"},defaults:{margins:"0 0 0 5",minWidth:100},cls:"commandpanel",dock:"bottom",items:[{xtype:"natbutton",itemId:"btnOk",text:"Ok",ui:"green",listeners:{scope:a,click:a.btnOk_click}},{xtype:"natbutton",itemId:"btnCancel",text:"Cancel",listeners:{scope:a,click:a.btnCancel_click}}]}]})},btnOk_click:function(a,f){var e=this.editorWindow.down("#sourceedit");var b=e.getAllLines();Ext.Array.erase(b,0,1);var c=Ext.Array.convertToString(b,false);c=Ext.String.removeFromStart(c,"{");c=Ext.String.removeFromEnd(c,"}");c=c.replace(/\s/g,"");if(c){c={params:this.functionParams,body:b}}else{c=null}this.setValue(c);this.editorWindow.close();this.focus(false,60)},btnCancel_click:function(){this.editorWindow.close();this.focus(false,60)},rawToValue:function(a){if(a=="Function..."){a=null}return a},valueToRaw:function(a){return a},getRawValue:function(){return this.rawValue},setRawValue:function(b){var a=this;a.rawValue=b;if(a.inputEl){a.inputEl.dom.value="Function..."}return b},isValid:function(){return true}});Ext.define("NAT.form.field.Hidden",{extend:"Ext.form.field.Hidden",alias:"widget.nathiddenfield",propertyPath:""});Ext.define("NAT.form.field.HtmlEditor",{extend:"Ext.form.field.HtmlEditor",alias:"widget.htmleditor",propertyPath:""});Ext.define("NAT.form.field.Lookup",{extend:"Ext.form.field.ComboBox",alias:"widget.natlookupfield",propertyPath:"",valueField:"_id",displayField:"name",editable:false,selectOnFocus:true,typeAhead:true,emptyText:"Please choose!",triggerAction:"none",matchFieldWidth:true,queryMode:"local",listConfig:{loadMask:false,width:400},initComponent:function(){this.callParent(arguments);this.on("beforequery",this.this_beforequery,this)},this_beforequery:function(){this.expand();return false},renderer:function(b,c){if(!this.store){return b}var a=this.store.getById(b);if(!a){return b}return a.get(this.displayField)},BindStore:function(a){this.bindStore(a)}});Ext.define("NAT.form.field.Object",{extend:"Ext.form.field.Trigger",alias:"widget.natobjectfield",requires:["NAT.edit.Source"],propertyPath:"",editable:false,functionName:"",functionParams:[],editorWindow:null,initComponent:function(){this.callParent(arguments)},onTriggerClick:function(){this.editorWindow=this.createEditor();this.editorWindow.show(null,function(d,c){this.onExpand()},this);this.editorWindow.center()},onExpand:function(){var a=this.getValue();var c=this.editorWindow.down("#sourceedit");var b=Ext.Array.convertToString(a,true);if(!b){b="{\n\n}"}c.setValue(b);c.focus(false,1)},createEditor:function(){var a=this;return Ext.create("widget.natwindow",{title:"Object Editor",modal:true,height:600,width:800,layout:{type:"vbox",align:"stretch"},items:[{xtype:"natsourceedit",itemId:"sourceedit",parser:"text",grow:true,fieldStyle:"border: none; background-image: none;",firstRowReadonly:false,lastRowReadonly:false,flex:1},{xtype:"container",layout:{type:"hbox",padding:"5",pack:"end",align:"middle"},defaults:{margins:"0 0 0 5",minWidth:100},cls:"commandpanel",dock:"bottom",items:[{xtype:"natbutton",itemId:"btnOk",text:"Ok",ui:"green",listeners:{scope:a,click:a.btnOk_click}},{xtype:"natbutton",itemId:"btnCancel",text:"Cancel",listeners:{scope:a,click:a.btnCancel_click}}]}]})},btnOk_click:function(a,e){var c=this.editorWindow.down("#sourceedit");var b=c.getAllLines();if(Ext.Object.isEmpty(Ext.Array.convertToObject(b))){b=null}this.setValue(b);this.editorWindow.close();this.focus(false,60)},btnCancel_click:function(){this.editorWindow.close();this.focus(false,60)},rawToValue:function(a){if(a=="Object..."){a=null}return a},valueToRaw:function(a){return a},getRawValue:function(){return this.rawValue},setRawValue:function(b){var a=this;a.rawValue=b;if(a.inputEl){a.inputEl.dom.value="Object..."}return b},isValid:function(){return true}});Ext.define("NAT.form.field.Radio",{extend:"Ext.form.field.Radio",alias:"widget.natradiofield",propertyPath:"",propertyValue:""});Ext.define("NAT.form.field.StringArray",{extend:"Ext.form.field.TextArea",alias:"widget.natstringarrayfield",propertyPath:"",getValue:function(){var a=this.callParent(arguments);if(a){return a.split(",")}else{return[]}},setValue:function(c){c=c||[];var a="";for(var b=0;c.length>b;b++){a+=c[b];if(c.length>b){a+=","}}this.callParent([a])}});Ext.define("NAT.form.field.StringArrayPicker",{extend:"Ext.form.field.Picker",alias:"widget.natstringarraypickerfield",requires:["Ext.form.field.TextArea"],propertyPath:"",editable:false,matchFieldWidth:false,initComponent:function(){this.callParent(arguments)},createPicker:function(){var a=this;return Ext.create("Ext.container.Container",{renderTo:document.body,floating:true,hidden:true,height:400,width:600,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textarea",itemId:"textarea",grow:true,fieldStyle:"border: none; background-image: none;",flex:1},{xtype:"button",itemId:"btnOk",text:"ok",dock:"bottom",listeners:{scope:a,click:a.btnOk_click}}],style:{background:"white"}})},btnOk_click:function(a,e){var b=this.picker.down("#textarea");var c=b.getValue();this.setRawValue(c);this.collapse()},onExpand:function(){var b=this.getRawValue();var a=this.picker.down("#textarea");a.setValue(b);a.focus(false,1)},onCollapse:function(){this.focus(false,60)},rawToValue:function(a){return a.split("\n")},valueToRaw:function(c){if(!Ext.isArray(c)){return""}var b="";for(var a=0;c.length>a;a++){b+=c[a];if(c.length-1>a){b+="\n"}}return b},getRawValue:function(){return this.rawValue},setRawValue:function(b){var a=this;a.rawValue=b;if(a.inputEl){a.inputEl.dom.value="String Array..."}return b}});Ext.define("NAT.form.field.Text",{extend:"Ext.form.field.Text",alias:"widget.nattextfield",msgTarget:"side",propertyPath:""});Ext.define("NAT.form.field.TextArea",{extend:"Ext.form.field.TextArea",alias:"widget.nattextarea",propertyPath:"",initComponent:function(){this.callParent(arguments)},Write:function(a){var b=this.getValue();this.setValue(b+a)},Writeln:function(a){var b=this.getValue();this.setValue(b+a+" \n")}});Ext.define("NAT.form.field.Time",{extend:"Ext.form.field.Time",alias:"widget.nattimefield",propertyPath:""});Ext.define("NAT.form.field.Trigger",{extend:"Ext.form.field.Trigger",alias:"widget.nattriggerfield",propertyPath:""});Ext.define("NAT.form.Panel",{extend:"Ext.form.Panel",alias:"widget.natform",store:null,propertyPath:"",children:[],isChanging:false,initComponent:function(){this.callParent(arguments);this.UpdateChildren()},UpdateChildren:function(){this.children=[];this.UpdateChildren_req(this)},UpdateChildren_req:function(a){if(!a.items){return}for(var b=0;a.items.getCount()>b;b++){var c=a.items.getAt(b);if(c.isFormField){this.children.push(c)}else{if(c.$className==="NAT.form.Panel"){this.children.push(c)}else{if(c.$className==="NAT.grid.Panel"){this.children.push(c)}else{if(c.$className==="NAT.tree.Panel"){this.children.push(c)}else{this.UpdateChildren_req(c)}}}}}},BindStore:function(a){this.store=a;this.InitBinding()},InitBinding:function(){if(!this.store){return}this.mon(this.store,"currentmodelchanged",function(c){this.ReadAllValue()},this);this.mon(this.store,"update",function(d,e,c,f){if(e==this.store.currModel){if(f.length>0){this.ReadValue(f[0],e.get(f[0]))}}},this);for(var a=0;this.children.length>a;a++){var b=this.children[a];if(b.isFormField){b.on("change",this.WriteValue,this);b.on("blur",this.field_blur,this)}}this.ReadAllValue()},field_blur:function(a,b){if(a.validateOnBlur||a.validateOnChange){return}if(!this.store){return}if(!this.store.hasModel()){return}this.store.currModel.ValidateField(a.propertyPath,function(d,e){if(a.preventMark){return}var c=this.store.currModel.errors.getByField(a.propertyPath);var f=(c.length==0);if(f){a.clearInvalid()}else{a.markInvalid(c[0].message)}},this)},ValidateEditorFields:function(d,c,a){d=d||{};if(!this.store){return}if(!this.store.hasModel()){return}this.store.currModel.errors.removeAll();var b=this;async.forEach(this.GetChildFields(),function(f,e){b.store.currModel.ValidateField(f.propertyPath,function(g,h){e(null,null)},b)},function(e,f){b.ShowErrors();if(b.store.currModel.errors.isValid()){Ext.callback(c,a,[null,null],0)}else{if(!d.skipFocusFirstInvalidField){b.FocusFirstInvalidField()}Ext.callback(c,a,[b.store.currModel.errors,null],0)}})},ValidateEditor:function(d,c,a){d=d||{};if(!this.store){return}if(!this.store.hasModel()){return}this.store.currModel.errors.removeAll();var b=this;this.store.currModel.ValidateModel(null,function(e,f){b.ShowErrors();if(b.store.currModel.errors.isValid()){Ext.callback(c,a,[null,null],0)}else{if(!d.skipFocusFirstInvalidField){b.FocusFirstInvalidField()}Ext.callback(c,a,[b.store.currModel.errors,null],0)}},this)},ShowErrors:function(){if(!this.store){return}if(!this.store.hasModel()){return}var b=this.GetChildFields();for(var c=0;b.length>c;c++){var e=b[c];if(e.preventMark){continue}var a=this.store.currModel.errors.getByField(e.propertyPath);var d=(a.length==0);if(d){e.clearInvalid()}else{e.markInvalid(a[0].message)}}},GetChildFields:function(){return Ext.Array.filter(this.children,function(a){return a.isFormField})},ReadAllValue:function(){if(this.isChanging){return}if(!this.store){return}if(!this.store.hasModel()){return}for(var a=0;this.children.length>a;a++){var c=this.children[a];if(!c.propertyPath){continue}if((c.isFormField)&&(c.$className==="NAT.form.field.Radio")){var b=this.store.currModel.get(c.propertyPath);this.isChanging=true;c.setValue(c.propertyValue===b);this.isChanging=false;continue}if(c.isFormField){this.isChanging=true;c.setValue(this.store.currModel.get(c.propertyPath));this.isChanging=false;continue}if(typeof c.BindStore=="function"){c.BindStore(this.store.currModel[c.propertyPath])}}},ReadValue:function(d,b){if(this.isChanging){return}for(var a=0;this.children.length>a;a++){var c=this.children[a];if(c.propertyPath==d){if((c.isFormField)&&(c.$className==="NAT.form.field.Radio")){this.isChanging=true;c.setValue(c.propertyValue===b);this.isChanging=false;continue}if(c.isFormField){this.isChanging=true;c.setValue(b);this.isChanging=false}}}},WriteValue:function(c,b,a,d){if(this.isChanging){return}if(!this.store){return}if(!this.store.hasModel()){return}if(c.$className==="NAT.form.field.Radio"){this.isChanging=true;this.store.currModel.set(c.propertyPath,c.propertyValue);this.isChanging=false;this.ReadAllRadioValue();return}this.isChanging=true;this.store.currModel.set(c.propertyPath,b);this.isChanging=false},ReadAllRadioValue:function(){if(this.isChanging){return}if(!this.store){return}if(!this.store.hasModel()){return}for(var a=0;this.children.length>a;a++){var c=this.children[a];if(!c.propertyPath){continue}if((c.isFormField)&&(c.$className==="NAT.form.field.Radio")){var b=this.store.currModel.get(c.propertyPath);this.isChanging=true;c.setValue(c.propertyValue===b);this.isChanging=false}}},SetEditable:function(d){var c=this.getForm();var a=c.getFields();for(var b=0;b<a.length;b++){var e=a.getAt(b);e.setReadOnly(!d)}},FocusFirstField:function(){var b=this.getForm();var a=b.getFields();if(a.length>0){var c=a.getAt(0);c.focus(true,200)}},FocusFirstInvalidField:function(){var c=this.getForm();var a=c.getFields();for(var b=0;b<a.length;b++){var d=a.getAt(b);if(d.hasErrors()){d.focus(true,200);return}}},Refresh:function(c,b,a){Ext.callback(b,a,[null,null],0)}});Ext.define("NAT.grid.column.Lookup",{extend:"Ext.grid.column.Column",alias:"widget.natlookupcolumn",initComponent:function(){this.callParent(arguments);if(!this.renderer){this.renderer=function(f,c,b,g,e){var d=this.columns[e],a=d.field.renderer(f,b);return Ext.util.Format.htmlEncode(a)}}},BindStore:function(a){this.getEditor().bindStore(a);this.fireEvent("bindstore",this,a)}});Ext.define("NAT.grid.column.Check",{extend:"Ext.grid.column.Column",alias:"widget.natcheckcolumn",constructor:function(){this.callParent(arguments)},renderer:function(c,b){var d=Ext.baseCSSPrefix,a=[d+"form-checkbox"];if(c){b.tdCls=d+"form-cb-checked"}b.style="text-align: -webkit-center;";return'<input type="button" class="'+a.join(" ")+'">'}});Ext.define("NAT.grid.Panel",{extend:"Ext.grid.Panel",alias:"widget.natgrid",requires:["Ext.grid.plugin.CellEditing"],deferredBind:false,deferredBindStore:null,constructor:function(a){this.callParent([a]);return this},initComponent:function(){this.viewConfig=Ext.applyIf(this.viewConfig||{},{loadMask:false});this.callParent(arguments);for(var a=0;this.columns.length>a;a++){var b=this.columns[a];if(b.natIsLookup){b.on("bindstore",this.luColumn_bindstore,this)}}this.on("beforedeselect",this.this_beforedeselect,this);this.on("select",this.this_select,this);this.on("deselect",this.this_deselect,this);this.on("afterrender",this.this_afterrender,this)},this_beforedeselect:function(b,a){},this_select:function(b,a){if(!this.store){return}this.store.Select(a)},this_deselect:function(b,a){if(!this.store){return}this.store.Deselect()},this_afterrender:function(){if(this.deferredBind){this.bindStore(this.deferredBindStore);this.deferredBind=false;this.deferredBindStore=null}},luColumn_bindstore:function(b,a){this.mon(a,"LoadCompleted",function(e,c,d){if(e&&e.length>0){this.getView().refresh()}},this)},BindStore:function(a){if(this.IsVisible()){this.bindStore(a)}else{this.deferredBind=true;this.deferredBindStore=a}},getSelected:function(){var a=this.getSelectionModel().getSelection();if(a.length==0){return null}return a[0]},Select:function(c,b,a){this.getSelectionModel().select(c,b,a)},Deselect:function(b,a){this.getSelectionModel().deselect(b,a)}});Ext.define("natjs.overrides.app.Application",{requires:["Ext.app.Application"]},function(){Ext.override(Ext.app.Application,{baseUrl:"",modelNamespace:"",constructor:function(a){a=a||{};Ext.global.app=this;this.baseUrl=this.GetBaseURL();this.modelNamespace=a.name+".model.";return this.callParent([a])},GetModelNameWithNamespace:function(a){if(Ext.String.startsWith(a,this.modelNamespace)){return a}return this.modelNamespace+a},GetModelNameWithoutNamespace:function(a){if(!Ext.String.startsWith(a,this.modelNamespace)){return a}return a.slice(this.modelNamespace.length)},GetBaseURL:function(){var a=location.href;var b=a.substring(0,a.indexOf("/",14));return b+"/"},ShowLoadingMask:function(){var a="Please wait...";Ext.getBody().mask(a,"loading")},HideLoadingMask:function(){Ext.getBody().unmask()},ShowLoadingMaskOnAjax:function(){var a="Please wait...";Ext.Ajax.on("beforerequest",function(){Ext.getBody().mask(a,"loading")},Ext.getBody());Ext.Ajax.on("requestcomplete",Ext.getBody().unmask,Ext.getBody());Ext.Ajax.on("requestexception",Ext.getBody().unmask,Ext.getBody())},natCreateModel:function(d,c){c=c||{};var g="";if(Ext.isString(d)){g=d}else{if(Ext.isFunction(d)){g=d.$className}}if(g==""){return null}var f=this.GetModelNameWithNamespace(g);var a=Ext.create(f);a.beginEdit();a.set("_type",g);a.set(c);for(var e=0;e<a.associations.length;e++){var b=a.associations.items[e];b.Created(a)}return a}})});Ext.define("natjs.overrides.container.Container",{requires:["Ext.container.Container"]},function(){Ext.override(Ext.container.Container,{queryByComponentId:function(a){var b=this.queryBy(function(c){return(c.id==a)},this);return(b.length==1)?b[0]:null},getChildByElement:function(e,a){var g,c,b=0,d=this.getRefItems(),f=d.length;e=Ext.getDom(e);for(;b<f;b++){g=d[b];c=g.getEl();if(c&&((c.dom===e)||c.contains(e))){if(a&&g.getChildByElement){return(g.getChildByElement(e,a))||g}else{return g}}}return null}})});Ext.define("natjs.overrides.data.AbstractStore",{requires:["Ext.data.AbstractStore"]},function(){Ext.override(Ext.data.AbstractStore,{currModel:null,Loading:false,Saving:false,sync:function(c){var e=this,b={},f=e.getNewRecords(),d=e.getUpdatedRecords(),a=e.getRemovedRecords(),g=false;if(f.length>0){b.create=f;g=true}if(d.length>0){b.update=d;g=true}if(a.length>0){b.destroy=a;g=true}e.needsSync=false;if(g&&e.fireEvent("beforesync",b)!==false){c=c||{};e.needsSync=true;e.proxy.batch(Ext.apply(c,{operations:b,listeners:e.getBatchListeners()}))}return e},Reset:function(c,a){this.removeAll(a);var b={lastModified:new Date(0),collection:this.collection};this.lastParams=Ext.merge(b,c)},Load:function(c,d,b){if(this.Loading){Ext.callback(d,b,[null,null],0);return}this.Loading=true;if(c){this.Reset(c)}var a={addRecords:true,params:this.lastParams,scope:this,callback:function(g,e,f){this.Loading=false;this.ProcessResponse(g,e,f);this.fireEvent("LoadCompleted",g,e,f);Ext.callback(d,b,[null,null],0)}};this.load(a)},Save:function(d,c,a){if(this.Saving){Ext.callback(c,a,[null,null],0);return}this.Saving=true;var b=this;async.waterfall([function(e){b.ValidateChangedModels(null,e,b)},function(f,e){var g={};g.scope=b;g.success=function(i,h){e(null,h)};g.failure=function(i,h){e("failure",h)};b.sync(g);g.needsSync=b.needsSync;if(!g.needsSync){e(null,g);return}if((g.needsSync)&&(!g.preventLoadingMask)){app.ShowLoadingMask()}}],function(f,e){b.Saving=false;if(f){alert("validation error, field: "+f.getAt(0).field)}e=e||{};if((e.needsSync)&&(!e.preventLoadingMask)){app.HideLoadingMask()}b.fireEvent("SaveCompleted",e);Ext.callback(c,a,[null,e],0)})},filterNew:function(a){return(a.IsNew())&&(a.isNATValid)},filterNewAll:function(a){return a.IsNew()},filterUpdated:function(a){return(!a.IsNew())&&(a.isNATDirty)&&(a.isNATValid)},filterUpdatedAll:function(a){return(!a.IsNew())&&(a.isNATDirty)},GetChangedModels:function(){return Ext.Array.union(this.getNewRecords(),this.getUpdatedRecords(),this.getRemovedRecords())},GetChangedModelsAll:function(){return Ext.Array.union(this.getNewRecordsAll(),this.getUpdatedRecordsAll(),this.getRemovedRecords())},IsChanged:function(){return(this.GetChangedModelsAll().length!=0)},ValidateChangedModels:function(c,b,a){async.forEach(this.GetChangedModelsAll(),function(e,d){e.ValidateModel(null,d,e)},function(d){Ext.callback(b,a,[d,null],0)})},Select:function(b,a){if(this.currModel==b){return}if(!a){this.OnSelect(this.currModel,b)}this.currModel=b;if(!a){this.OnCurrentModelChanged()}},Deselect:function(a){if(this.Loading){return}if(this.currModel==null){return}if(!a){this.OnDeselect(this.currModel)}this.currModel=null;if(!a){this.OnCurrentModelChanged()}},hasModel:function(){return((this.currModel)&&(typeof this.currModel=="object"))},getModelName:function(){var a="";if(Ext.isString(this.model)){a=this.model}if(Ext.isFunction(this.model)){a=this.model.$className}if(Ext.isObject(this.model)){a=this.model.$className}return app.GetModelNameWithoutNamespace(a)},updateCurrModel:function(){},OnSelect:function(b,a){this.fireEvent("select",b,a)},OnDeselect:function(a){this.fireEvent("deselect",a)},OnModelDirtyChanged:function(a){this.fireEvent("modeldirtychanged",a)},OnCurrentModelChanged:function(){this.fireEvent("currentmodelchanged",this.currModel)}})});Ext.define("natjs.overrides.data.BelongsToAssociation",{requires:["Ext.data.BelongsToAssociation"]},function(){Ext.override(Ext.data.BelongsToAssociation,{constructor:function(c){var e=this;Ext.data.BelongsToAssociation.superclass.constructor.call(this,c);var a=e.ownerModel.prototype,d=e.getterName||"get"+e.name,b=e.setterName||"set"+e.name;Ext.applyIf(e,{storeName:"belongsTo_"+e.name,foreignKey:e.name+"_id",associationKey:e.name});a[d]=e.createGetter();a[b]=e.createSetter();a[e.name]=e.createStore()},createStore:function(){var f=this,g=f.associatedModel,c=f.storeName,d=f.foreignKey,a=f.primaryKey,b=f.autoLoad,e=f.storeConfig||{};return function(){var k=this,i,j,h={};if(k[c]===undefined){h[d]=k.get(a);i=Ext.apply({},e,{model:g,modelDefaults:h});k[c]=Ext.create("widget.natmodelstore",i);if(b){k[c].load()}k[c].on("update",k.associationChanged,k);k[c].on("add",k.associationChanged,k);k[c].on("remove",k.associationChanged,k)}return k[c]}},Created:function(a){var b=a[this.name]();b.CreateModel()},Merge:function(a,c){var b=a[this.storeName];var d=c[this.storeName];b.Merge(d)},read:function(b,e){var c=b[this.name](),d=c.proxy,a=d.getReader();var f=a.read([e]).records[0];c.SetModel(f);f.Loaded()},write:function(a,e){var b=a[this.storeName],c=b.proxy,d=c.getWriter();e[this.name]=d.getRecordData(b.model)},reject:function(a,c){var b=a[this.storeName];if(b){b.reject()}},commit:function(a,c){var b=a[this.storeName];if(b){b.commit()}},IsChanged:function(a){var b=a[this.storeName];return b.IsChanged()}})});Ext.define("natjs.overrides.data.HasManyAssociation",{requires:["Ext.data.HasManyAssociation"]},function(){Ext.override(Ext.data.HasManyAssociation,{constructor:function(c){var d=this,a,b;Ext.data.HasManyAssociation.superclass.constructor.call(this,c);d.name=d.name||Ext.util.Inflector.pluralize(d.associatedName.toLowerCase());a=d.ownerModel.prototype;b=d.name;Ext.applyIf(d,{storeName:"hasMany_"+d.name,foreignKey:d.ownerName.toLowerCase()+"_id"});a[b]=d.createStore()},createStore:function(){var g=this,h=g.associatedModel,c=g.storeName,d=g.foreignKey,a=g.primaryKey,f=g.filterProperty,b=g.autoLoad,e=g.storeConfig||{};return function(){var l=this,j,k,i={};if(l[c]===undefined){if(f){k={property:f,value:l.get(f),exactMatch:true}}else{k={property:d,value:l.get(a),exactMatch:true}}i[d]=l.get(a);j=Ext.apply({},e,{model:h,filters:[k],remoteFilter:false,modelDefaults:i});l[c]=Ext.create("widget.natstore",j);if(b){l[c].load()}l[c].on("update",l.associationChanged,l);l[c].on("add",l.associationChanged,l);l[c].on("remove",l.associationChanged,l)}return l[c]}},Created:function(a){a[this.name]()},Merge:function(a,c){var b=a[this.storeName];var d=c[this.storeName];b.Merge(d)},read:function(c,h){var e=c[this.name](),g=e.proxy,a=g.getReader(),b;var d=a.read(h).records;e.add(d);for(var f=0;f<d.length;f++){d[f].Loaded()}b=this.associatedModel.prototype.associations.findBy(function(i){return i.type==="belongsTo"&&i.associatedName===c.$className});if(b){e.data.each(function(i){i[b.instanceName]=c})}},write:function(a,e){var b=a[this.storeName],c=b.proxy,d=c.getWriter();var f=e[this.name]=[];b.data.each(function(h){var g=d.getRecordData(h);f.push(g)})},reject:function(a,c){var b=a[this.storeName];if(b){b.reject()}},commit:function(a,c){var b=a[this.storeName];if(b){b.commit()}},IsChanged:function(a){var b=a[this.storeName];return b.IsChanged()}})});Ext.define("natjs.overrides.data.TreeStore",{requires:["Ext.data.TreeStore"]},function(){Ext.override(Ext.data.TreeStore,{load:function(a){a=a||{};a.params=a.params||{};var b=this;return Ext.data.TreeStore.superclass.load.call(this,a)},setRootNode:function(a,e){var d=this,c=d.model,b=c.prototype.idProperty;a=a||{};if(!a.isModel){Ext.applyIf(a,{id:d.defaultRootId,text:"Root",allowDrag:false});if(a[b]===undefined){a[b]=d.defaultRootId}Ext.data.NodeInterface.decorate(c);a=Ext.ModelManager.create(a,c)}else{if(a.isModel&&!a.isNode){Ext.data.NodeInterface.decorate(c)}}Ext.data.NodeInterface.decorate(a);d.getProxy().getReader().buildExtractors(true);d.tree.setRootNode(a);if(e!==true&&!a.isLoaded()&&(d.autoLoad===true||a.isExpanded())){d.load({node:a})}a.join(this);return a}})});Ext.define("natjs.overrides.data.Store",{requires:["Ext.data.Store"]},function(){Ext.override(Ext.data.Store,{GetModelByPropertyValue:function(d,f,e){var b=[];for(var c=0;c<this.getCount();c++){var a=this.getAt(c);if(a.get(d)==f){if(e){return a}b.push(a)}}return b},GetModelIdByPropertyValue:function(b,c){var a=this.GetModelByPropertyValue(b,c,true);if(a){return a.getId()}return null}})});Ext.define("natjs.overrides.data.validations",{requires:["Ext.data.validations"]},function(){Ext.data.validations.presenceMessage="This field is required";Ext.data.validations.getMessage=function(a){if(a.type=="length"){return"Length must be minimum "+a.min+" and maximum "+a.max+" character!"}return null}});Ext.define("natjs.overrides.form.field.Field",{requires:["Ext.form.field.Base"]},function(){Ext.override(Ext.form.field.Base,{validateOnChange:false,validateOnBlur:false,msgTarget:"side",propertyPath:"",hasErrors:function(){return((this.activeErrors)&&(this.activeErrors.length>0))}})});Ext.define("natjs.overrides.grid.CellEditor",{requires:["Ext.grid.CellEditor"]},function(){Ext.override(Ext.grid.CellEditor,{realign:function(f){var k=this,h=k.boundEl,j=h.first(),c=j.dom.childNodes,g=c.length,e=Ext.Array.clone(k.offsets),l=k.field.inputEl,b,i,n,a,m;var d=h;var o=h.getViewSize();if(g===1&&c[0].nodeType!==3){d=c[0];o={width:d.offsetWidth,height:d.offsetHeight}}if(f===true){k.field.setWidth(o.width);k.field.setHeight(o.height)}e[0]-=l.dom.offsetLeft;e[1]-=l.dom.offsetTop;k.alignTo(d,k.alignment,e)}})});Ext.define("natjs.overrides.AbstractComponent",{requires:["Ext.AbstractComponent"]},function(){Ext.override(Ext.AbstractComponent,{deferredUpdateFrame:false,viewNode:null,initComponent:function(){this.callParent(arguments);this.on("move",this.this_move,this);this.on("resize",this.this_resize,this);this.on("afterrender",this.this_afterrender,this)},this_move:function(b,a,d,c){if(!this.viewNode){return}},this_resize:function(c,d,a,b,f,e){if(!this.viewNode){return}},this_afterrender:function(){if(this.deferredUpdateFrame){this.updateFrame();this.deferredUpdateFrame=false}},IsVisible:function(c){var b=this.up("tabpanel");if(!b){return this.isVisible(c)}var a=b.getActiveTab();return((this===a)||(this.isDescendantOf(a)))},SetEnabled:function(a){this.setDisabled(!a)},getFramedChildren:function(){var a=[];if(this.items){a=this.queryBy(function(b){return(!!b.isFocusFramed)},this)}return a},updateFrame:function(){if(!this.IsVisible()){this.deferredUpdateFrame=true;return}if(((this.isFocusFramed)||(this.isSelectFramed))&&(!this.isNatFramed)){var b=this.getEl();var a=[];a.push('<div id="'+b.id+'-north-frame" class="nat-focus-frame nat-focus-frame-north"></div>');a.push('<div id="'+b.id+'-east-frame" class="nat-focus-frame nat-focus-frame-east"></div>');a.push('<div id="'+b.id+'-south-frame" class="nat-focus-frame nat-focus-frame-south"></div>');a.push('<div id="'+b.id+'-west-frame" class="nat-focus-frame nat-focus-frame-west"></div>');b.position();Ext.DomHelper.append(b,a.join(""));this["north-frame"]=b.getById(b.id+"-north-frame");this["east-frame"]=b.getById(b.id+"-east-frame");this["south-frame"]=b.getById(b.id+"-south-frame");this["west-frame"]=b.getById(b.id+"-west-frame");this.isNatFramed=true}if(this.isSelectFramed){this["north-frame"].addCls("nat-select-frame");this["east-frame"].addCls("nat-select-frame");this["south-frame"].addCls("nat-select-frame");this["west-frame"].addCls("nat-select-frame")}if((this.isFocusFramed)&&(!this.isSelectFramed)){this["north-frame"].removeCls("nat-select-frame");this["east-frame"].removeCls("nat-select-frame");this["south-frame"].removeCls("nat-select-frame");this["west-frame"].removeCls("nat-select-frame")}if((!this.isFocusFramed)&&(!this.isSelectFramed)&&(this.isNatFramed)){this["north-frame"].remove();this["east-frame"].remove();this["south-frame"].remove();this["west-frame"].remove();this.isNatFramed=false}},focusFrame:function(){this.isFocusFramed=true;this.updateFrame()},unFocusFrame:function(){this.isFocusFramed=false;this.updateFrame()},selectFrame:function(){this.isSelectFramed=true;this.updateFrame()},unSelectFrame:function(){this.isSelectFramed=false;this.updateFrame()}})});Ext.define("natjs.overrides.Object",{},function(){Ext.Array.find=function(array,attribute,value){if(!array){return}var matches=Ext.Array.filter(array,function(item){return(item[attribute]==value)});if(matches.length>0){return matches[0]}return null};Ext.Array.findAll=function(array,attribute,value){if(!array){return}return Ext.Array.filter(array,function(item){return(item[attribute]==value)})};Ext.Array.convertToString=function(array,includeNewLine){if(!array){return""}var result="";for(var j=0;array.length>j;j++){result+=array[j];if((includeNewLine)&&(j<array.length-1)){result+="\n"}}return result};Ext.Array.convertToObject=function(array){var strValue=Ext.Array.convertToString(array,false);strValue=Ext.String.removeFromStart(strValue,"{");strValue=Ext.String.removeFromEnd(strValue,"}");var properties=strValue.split(",");var obj={};properties.forEach(function(property){if(!property){return}var tup=property.split(":");tup[0]=Ext.String.trim(tup[0]);tup[1]=Ext.String.trim(tup[1]);if(Ext.String.startsWith(tup[1],"function")){obj[tup[0]]=tup[1]}else{obj[tup[0]]=eval(tup[1])}});return obj}});Ext.define("Ext.data.NodeInterface",{requires:["Ext.data.Field"],statics:{decorate:function(b){var a,c;if(typeof b=="string"){b=Ext.ModelManager.getModel(b)}else{if(b.isModel){b=Ext.ModelManager.getModel(b.modelName)}}if(b.prototype.isNode){return}a=b.prototype.idProperty;c=b.prototype.fields.get(a).type.type;b.override(this.getPrototypeBody());this.applyFields(b,[{name:"parentId",type:c,defaultValue:null},{name:"index",type:"int",defaultValue:null},{name:"depth",type:"int",defaultValue:0},{name:"expanded",type:"bool",defaultValue:false,persist:false},{name:"expandable",type:"bool",defaultValue:true,persist:false},{name:"checked",type:"auto",defaultValue:null,persist:false},{name:"leaf",type:"bool",defaultValue:false},{name:"cls",type:"string",defaultValue:null,persist:false},{name:"iconCls",type:"string",defaultValue:null,persist:false},{name:"icon",type:"string",defaultValue:null,persist:false},{name:"root",type:"boolean",defaultValue:false,persist:false},{name:"isLast",type:"boolean",defaultValue:false,persist:false},{name:"isFirst",type:"boolean",defaultValue:false,persist:false},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false},{name:"loaded",type:"boolean",defaultValue:false,persist:false},{name:"loading",type:"boolean",defaultValue:false,persist:false},{name:"href",type:"string",defaultValue:null,persist:false},{name:"hrefTarget",type:"string",defaultValue:null,persist:false},{name:"qtip",type:"string",defaultValue:null,persist:false},{name:"qtitle",type:"string",defaultValue:null,persist:false},{name:"children",type:"auto",defaultValue:null,persist:false}])},applyFields:function(c,b){var g=c.prototype,a=g.fields,f=a.keys,e=b.length,h,d;for(d=0;d<e;d++){h=b[d];if(!Ext.Array.contains(f,h.name)){a.add(new Ext.data.Field(h))}}},removeField:function(b,d){var c=b.prototype,a=c.fields;return a.removeAtKey(d)},removeFields:function(h,f){var b=h.prototype,e=b.fields,k=e.keys,g=f.length,c,d,a,j=[];for(d=0;d<g;d++){c=j[d];if(Ext.Array.contains(k,c.name)){j.push(c);e.remove(c)}}return j},getPrototypeBody:function(){return{isNode:true,constructor:function(){var a=this;this.callParent(arguments);Ext.applyIf(a,{firstChild:null,lastChild:null,parentNode:null,previousSibling:null,nextSibling:null,childNodes:[]});a.enableBubble(["append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert","expand","collapse","beforeexpand","beforecollapse","sort"]);return a},createNode:function(a){if(Ext.isObject(a)&&!a.isModel){a=Ext.ModelManager.create(a,this.modelName)}if(!a.childNodes){Ext.applyIf(a,{firstChild:null,lastChild:null,parentNode:null,previousSibling:null,nextSibling:null,childNodes:[]})}return a},isLeaf:function(){return this.get("leaf")===true},setFirstChild:function(a){this.firstChild=a},setLastChild:function(a){this.lastChild=a},updateInfo:function(f){var l=this,b=l.isRoot(),j=l.parentNode,d=(!j||b?true:j.firstChild===l),h=(!j||b?true:j.lastChild===l),g=0,m=l,a=l.childNodes,k=a.length,e=0,c=l.phantom;while(m.parentNode){++g;m=m.parentNode}l.beginEdit();l.set({isFirst:d,isLast:h,depth:g,index:j?j.indexOf(l):0,parentId:j?j.getId():null});l.endEdit(true);if(f){l.commit();l.phantom=c}for(e=0;e<k;e++){a[e].updateInfo(f)}},isLast:function(){return this.get("isLast")},isFirst:function(){return this.get("isFirst")},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){var a=this;if(a.get("expandable")){return !(a.isLeaf()||(a.isLoaded()&&!a.hasChildNodes()))}return false},appendChild:function(b,j,c){var g=this,d,f,e,h,a;if(Ext.isArray(b)){g.callStore("suspendAutoSync");for(d=0,f=b.length-1;d<f;d++){g.appendChild(b[d])}g.callStore("resumeAutoSync");g.appendChild(b[f])}else{b=g.createNode(b);if(j!==true&&(!g.hasListeners.beforeappend||g.fireEvent("beforeappend",g,b)===false)){return false}e=g.childNodes.length;h=b.parentNode;if(h){if(j!==true&&(!g.hasListeners.beforeremove||b.fireEvent("beforemove",b,h,g,e)===false)){return false}h.removeChild(b,false,false,true)}e=g.childNodes.length;if(e===0){g.setFirstChild(b)}g.childNodes.push(b);b.parentNode=g;b.nextSibling=null;g.setLastChild(b);a=g.childNodes[e-1];if(a){b.previousSibling=a;a.nextSibling=b;a.updateInfo(c)}else{b.previousSibling=null}b.updateInfo(c);if(!g.isLoaded()){g.set("loaded",true)}else{if(g.childNodes.length===1){if(!g.editing){g.afterEdit([])}}}if(!b.isLeaf()&&b.phantom){b.set("loaded",true)}if(j!==true){g.fireEvent("append",g,b,e);if(h){b.fireEvent("move",b,h,g,e)}}for(var k=0;g.stores.length>k;k++){if(g.stores[k].getRootNode){b.join(g.stores[k])}}return b}},getBubbleTarget:function(){return this.parentNode},removeChild:function(a,f,h,g){var e=this,d=e.indexOf(a),c,b;if(d==-1||(h!==true&&(!e.hasListeners.beforeremove||e.fireEvent("beforeremove",e,a,!!g)===false))){return false}Ext.Array.erase(e.childNodes,d,1);if(e.firstChild==a){e.setFirstChild(a.nextSibling)}if(e.lastChild==a){e.setLastChild(a.previousSibling)}if(a.previousSibling){a.previousSibling.nextSibling=a.nextSibling}if(a.nextSibling){a.nextSibling.previousSibling=a.previousSibling}for(c=d>0?d-1:0,b=e.childNodes.length;c<b;c++){e.childNodes[c].updateInfo()}if(!e.childNodes.length){e.set("loaded",e.isLoaded())}if(h!==true){if(e.hasListeners.remove){e.fireEvent("remove",e,a,!!g)}}for(var j=0;e.stores.length>j;j++){if(e.stores[j].getRootNode){a.unjoin(e.stores[j])}}if(f){a.destroy(true)}else{a.clear()}return a},copy:function(d,c){var f=this,b=f.callOverridden(arguments),a=f.childNodes?f.childNodes.length:0,e;if(c){for(e=0;e<a;e++){b.appendChild(f.childNodes[e].copy(true))}}return b},clear:function(a){var b=this;b.parentNode=b.previousSibling=b.nextSibling=null;if(a){b.firstChild=b.lastChild=null}},destroy:function(b){var d=this,c=d.destroyOptions,a=d.childNodes,e=a.length,f;if(b===true){d.clear(true);for(f=0;f<e;f++){a[f].destroy(true)}d.childNodes=null;delete d.destroyOptions;d.callOverridden([c])}else{d.destroyOptions=b;d.remove(true)}},insertBefore:function(b,f,k){var g=this,e=g.indexOf(f),h=b.parentNode,j=e,c,a,d;if(!f){return g.appendChild(b)}if(b==f){return false}b=g.createNode(b);if(k!==true&&(!g.hasListeners.beforeinsert||g.fireEvent("beforeinsert",g,b,f)===false)){return false}if(h==g&&g.indexOf(b)<e){j--}if(h){if(k!==true&&(!g.hasListeners.beforeremove||b.fireEvent("beforemove",b,h,g,e,f)===false)){return false}h.removeChild(b,false,false,true)}if(j===0){g.setFirstChild(b)}Ext.Array.splice(g.childNodes,j,0,b);b.parentNode=g;b.nextSibling=f;f.previousSibling=b;a=g.childNodes[j-1];if(a){b.previousSibling=a;a.nextSibling=b}else{b.previousSibling=null}for(d=j>0?j-1:0,c=g.childNodes.length;d<c;d++){g.childNodes[d].updateInfo()}if(!g.isLoaded()){g.set("loaded",true)}else{if(g.childNodes.length===1){g.set("loaded",g.isLoaded())}}if(!b.isLeaf()&&b.phantom){b.set("loaded",true)}if(k!==true){if(g.hasListeners.insert){g.fireEvent("insert",g,b,f)}if(h&&g.hasListeners.move){b.fireEvent("move",b,h,g,j,f)}}for(var l=0;g.stores.length>l;l++){if(g.stores[l].getRootNode){b.join(g.stores[l])}}return b},insertChild:function(a,c){var b=this.childNodes[a];if(b){return this.insertBefore(c,b)}else{return this.appendChild(c)}},remove:function(b,c){var a=this.parentNode;if(a){a.removeChild(this,b,c)}return this},removeAll:function(a,b){var d=this.childNodes,c;while((c=d[0])){this.removeChild(c,a,b)}return this},getChildAt:function(a){return this.childNodes[a]},replaceChild:function(a,d,c){var b=d?d.nextSibling:null;this.removeChild(d,false,c);this.insertBefore(a,b,c);return d},indexOf:function(a){return Ext.Array.indexOf(this.childNodes,a)},indexOfId:function(d){var c=this.childNodes,a=c.length,b=0;for(;b<a;++b){if(c[b].getId()===d){return b}}return -1},getPath:function(d,c){d=d||this.idProperty;c=c||"/";var b=[this.get(d)],a=this.parentNode;while(a){b.unshift(a.get(d));a=a.parentNode}return c+b.join(c)},getDepth:function(){return this.get("depth")},bubble:function(c,b,a){var d=this;while(d){if(c.apply(b||d,a||[d])===false){break}d=d.parentNode}},cascade:function(){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Node: cascade has been deprecated. Please use cascadeBy instead.")}return this.cascadeBy.apply(this,arguments)},cascadeBy:function(d,c,a){if(d.apply(c||this,a||[this])!==false){var f=this.childNodes,e=f.length,b;for(b=0;b<e;b++){f[b].cascadeBy(d,c,a)}}},eachChild:function(d,c,a){var f=this.childNodes,e=f.length,b;for(b=0;b<e;b++){if(d.apply(c||this,a||[f[b]])===false){break}}},findChild:function(b,c,a){return this.findChildBy(function(){return this.get(b)==c},null,a)},findChildBy:function(g,f,b){var e=this.childNodes,a=e.length,d=0,h,c;for(;d<a;d++){h=e[d];if(g.call(f||h,h)===true){return h}else{if(b){c=h.findChildBy(g,f,b);if(c!==null){return c}}}}return null},contains:function(a){return a.isAncestor(this)},isAncestor:function(a){var b=this.parentNode;while(b){if(b==a){return true}b=b.parentNode}return false},sort:function(f,b,a){var d=this.childNodes,e=d.length,c,g;if(e>0){Ext.Array.sort(d,f);for(c=0;c<e;c++){g=d[c];g.previousSibling=d[c-1];g.nextSibling=d[c+1];if(c===0){this.setFirstChild(g)}if(c==e-1){this.setLastChild(g)}g.updateInfo();if(b&&!g.isLeaf()){g.sort(f,true,true)}}if(a!==true){this.fireEvent("sort",this,d)}}},isExpanded:function(){return this.get("expanded")},isLoaded:function(){return this.get("loaded")},isLoading:function(){return this.get("loading")},isRoot:function(){return !this.parentNode},isVisible:function(){var a=this.parentNode;while(a){if(!a.isExpanded()){return false}a=a.parentNode}return true},expand:function(a,d,b){var c=this;if(!c.isLeaf()){if(c.isLoading()){c.on("expand",function(){c.expand(a,d,b)},c,{single:true})}else{if(!c.isExpanded()){c.fireEvent("beforeexpand",c,function(){c.set("expanded",true);if(c.hasListeners.expand){c.fireEvent("expand",c,c.childNodes,false)}if(a){c.expandChildren(true,d,b)}else{Ext.callback(d,b||c,[c.childNodes])}},c)}else{if(a){c.expandChildren(true,d,b)}else{Ext.callback(d,b||c,[c.childNodes])}}}}else{Ext.callback(d,b||c)}},expandChildren:function(d,h,j){var g=this,e=0,a=g.childNodes,f=a.length,c,b=0;for(;e<f;++e){c=a[e];if(!c.isLeaf()){b++;a[e].expand(d,function(){b--;if(h&&!b){Ext.callback(h,j||g,[g.childNodes])}})}}if(!b&&h){Ext.callback(h,j||g,[g.childNodes])}},collapse:function(a,d,b){var c=this;if(!c.isLeaf()){if(!c.collapsing&&c.isExpanded()){c.fireEvent("beforecollapse",c,function(){c.set("expanded",false);if(c.hasListeners.collapse){c.fireEvent("collapse",c,c.childNodes,false)}if(a){c.collapseChildren(true,d,b)}else{Ext.callback(d,b||c,[c.childNodes])}},c)}else{if(a){c.collapseChildren(true,d,b)}}}else{Ext.callback(d,b||c,[c.childNodes])}},collapseChildren:function(d,h,j){var g=this,e=0,b=g.childNodes,f=b.length,c,a=0;for(;e<f;++e){c=b[e];if(!c.isLeaf()){a++;b[e].collapse(d,function(){a--;if(h&&!a){Ext.callback(h,j||g,[g.childNodes])}})}}if(!a&&h){Ext.callback(h,j||g,[g.childNodes])}}}}}});Ext.define("natjs.overrides.Object",{},function(){Ext.Object.toQueryString=function(d,b){var e=[],c=[],g,f,h,a,k;for(g in d){if(d.hasOwnProperty(g)){e=e.concat(Ext.Object.toQueryObjects(g,d[g],b))}}for(f=0,h=e.length;f<h;f++){a=e[f];k=a.value;if(Ext.isEmpty(k)){k=""}else{if(Ext.isDate(k)){k=k.toJSON()}}c.push(encodeURIComponent(a.name)+"="+encodeURIComponent(String(k)))}return c.join("&")};Ext.Object.ReplaceKeyNames=function(c,d,b){var a={};Ext.Object.each(c,function(e,g,f){a[e.replace(d,b)]=g});return a};Ext.Object.Flatten=function(b){function c(e,g,d){if(!Ext.isObject(g)){d[e]=g}else{for(var f in g){if(g.hasOwnProperty(f)){var h=g[f];if(e){f=e+"."+f}c(f,h,d)}}}}var a={};c("",b,a);return a};Ext.Object.FlattenOneLevel=function(c){var a={};for(var d in c){if(!c.hasOwnProperty(d)){continue}var e=c[d];if(!Ext.isObject(e)){a[d]=e}else{for(var b in e){if(!e.hasOwnProperty(b)){continue}a[d+"."+b]=e[b]}}}return a};Ext.Object.isEmpty=function(a){for(var b in a){if(a.hasOwnProperty(b)){return false}}return true}});Ext.define("natjs.overrides.String",{},function(){Ext.String.startsWith=function(b,a){return b.slice(0,a.length)==a};Ext.String.endsWith=function(b,a){return b.slice(-a.length)==a};Ext.String.removeFromStart=function(b,a){if(!Ext.String.startsWith(b,a)){return b}return b.slice(a.length)};Ext.String.removeFromEnd=function(b,a){if(!Ext.String.endsWith(b,a)){return b}return b.slice(0,b.length-a.length)}});Ext.define("NAT.tree.Panel",{extend:"Ext.tree.Panel",alias:"widget.nattree",requires:["NAT.tree.plugin.CellEditing"],deferredBind:false,deferredBindStore:null,animate:false,constructor:function(a){this.callParent([a]);return this},initComponent:function(){this.callParent(arguments);this.on("beforedeselect",this.tree_beforedeselect,this);this.on("select",this.tree_select,this);this.on("deselect",this.tree_deselect,this);this.on("afterrender",this.tree_afterrender,this)},tree_beforedeselect:function(b,a){},tree_select:function(b,a){if(!this.store){return}this.store.Select(a)},tree_deselect:function(b,a){if(!this.store){return}this.store.Deselect()},tree_afterrender:function(){if(this.deferredBind){this.bindStore(this.deferredBindStore);this.deferredBind=false;this.deferredBindStore=null}},BindStore:function(a){if(this.IsVisible()){this.bindStore(a)}else{this.deferredBind=true;this.deferredBindStore=a}},bindStore:function(b){if(!b){return}this.store=b;var c=this;c.mon(c.store,{scope:c,rootchange:c.onRootChange,clear:c.onClear});c.relayEvents(c.store,["beforeload","load"]);c.mon(c.store,{append:c.createRelayer("itemappend"),remove:c.createRelayer("itemremove"),move:c.createRelayer("itemmove",[0,4]),insert:c.createRelayer("iteminsert"),beforeappend:c.createRelayer("beforeitemappend"),beforeremove:c.createRelayer("beforeitemremove"),beforemove:c.createRelayer("beforeitemmove"),beforeinsert:c.createRelayer("beforeiteminsert"),expand:c.createRelayer("itemexpand",[0,1]),collapse:c.createRelayer("itemcollapse",[0,1]),beforeexpand:c.createRelayer("beforeitemexpand",[0,1]),beforecollapse:c.createRelayer("beforeitemcollapse",[0,1])});var a=b.getRootNode();if(!a){return}this.view.setRootNode(a)},getSelected:function(){var a=this.getSelectionModel().getSelection();if(a.length==0){return null}return a[0]},SelectRoot:function(a){this.getSelectionModel().select(this.getRootNode(),false,a)},Select:function(c,b,a){this.getSelectionModel().select(c,b,a)},getById:function(a){return this.store.getById(a)},SelectById:function(b){if(!this.store){return}var a=this.store.getNodeById(b);if(!a){return}this.selectPath(a.getPath())},Deselect:function(b,a){this.getSelectionModel().deselect(b,a)}});Ext.define("NAT.view.MessageDialog",{extend:"Ext.window.Window",alias:"widget.natmessagedialog",width:500,height:250,resizable:false,closable:false,layout:{align:"top",type:"hbox"},modal:true,bodyPadding:10,callback:null,scope:null,initComponent:function(){this.items=[{xtype:"image",itemId:"img",height:70,width:70,flex:0},{xtype:"component",itemId:"lMessage",margin:"10 10 10 10",flex:1}];this.dockedItems=[{xtype:"container",height:50,cls:"commandpanel",layout:{align:"stretch",padding:10,type:"hbox"},dock:"bottom",defaults:{flex:1,margin:"0 5",hidden:true},items:[{xtype:"button",itemId:"btnSave",ui:"green",text:"Save",result:"save"},{xtype:"button",itemId:"btnDontSave",ui:"blue",text:"Don't Save",result:"dontsave"},{xtype:"button",itemId:"btnOk",ui:"green",text:"Ok",result:"ok"},{xtype:"button",itemId:"btnYes",ui:"green",text:"Yes",result:"yes"},{xtype:"button",itemId:"btnNo",ui:"blue",text:"No",result:"no"},{xtype:"button",itemId:"btnCancel",ui:"gray",text:"Cancel",result:"cancel"}]}];this.callParent(arguments);this.down("#btnSave").on("click",this.btn_click,this);this.down("#btnDontSave").on("click",this.btn_click,this);this.down("#btnOk").on("click",this.btn_click,this);this.down("#btnYes").on("click",this.btn_click,this);this.down("#btnNo").on("click",this.btn_click,this);this.down("#btnCancel").on("click",this.btn_click,this)},ShowModal:function(c,i,j){this.callback=i;this.scope=j;c=c||{};c.type=c.type||"success";c.msg=c.msg||"";var g=this.down("#img");var a=this.down("#lMessage");var e=this.down("#btnSave");var d=this.down("#btnDontSave");var k=this.down("#btnOk");var h=this.down("#btnYes");var b=this.down("#btnNo");var f=this.down("#btnCancel");if(c.type=="message"){this.setTitle(c.type);g.setSrc("/natjs/resources/images/message.png");k.setVisible(true)}if(c.type=="success"){this.setTitle(c.type);g.setSrc("/natjs/resources/images/message.png");k.setVisible(true)}else{if(c.type=="failure"){this.setTitle(c.type);g.setSrc("/natjs/resources/images/error.png");k.setVisible(true)}else{if(c.type=="confirm"){this.setTitle(c.type);g.setSrc("/natjs/resources/images/warning.png");h.setVisible(true);b.setVisible(true)}else{if(c.type=="confirmexit"){this.setTitle("confirm");g.setSrc("/natjs/resources/images/warning.png");e.setVisible(true);d.setVisible(true);f.setVisible(true)}else{if(c.type=="error"){this.setTitle(c.type);g.setSrc("/natjs/resources/images/error.png");k.setVisible(true)}else{if(c.type=="custom"){this.setTitle(c.title);g.setSrc("/natjs/resources/images/"+c.image+".png");k.setVisible(true);f.setVisible(true);k.setText(c.okButtonText)}}}}}}a.html=c.msg;this.show()},btn_click:function(a){Ext.callback(this.callback,this.scope,[null,{result:a.result}],0);this.close()}});Ext.define("NAT.window.Window",{extend:"Ext.window.Window",alias:"widget.natwindow",isActivated:false,initComponent:function(){this.callParent(arguments);this.on("activate",this.this_activate,this);this.InitEditorsBinding()},this_activate:function(){if(this.isActivated){return}this.fireEvent("shown");this.isActivated=true},InitEditorsBinding:function(){var c=this.query("form");for(var a=0;a<c.length;a++){var b=c[a];b.InitBinding()}},FocusFirstField:function(){var a=this.query("[isFormField]");if(a.length>0){var b=a[0];b.focus(true,200)}},FocusFirstInvalidField:function(){var a=this.query("[isFormField]");for(var b=0;b<a.length;b++){var c=a[b];if(c.hasErrors()){c.focus(true,200);return}}},Refresh:function(c,b,a){Ext.callback(b,a,[null,null],0)},RebindUI:function(){this.InitEditorsBinding()},RefreshUI:function(){}});Ext.define("NAT.data.Model",{extend:"Ext.data.Model",alias:"widget.natdatamodel",fields:[{name:"_id",type:"string"},{name:"_type",type:"string"}],fieldsInfo:[],idProperty:"_id",state:null,isNATDirty:false,isNATValid:false,errors:null,skipFieldSetters:[],constructor:function(b,c,a){this.callParent(arguments);this.errors=Ext.create("Ext.data.Errors")},Created:function(){},associationChanged:function(){this.afterEdit()},get:function(c){if(Ext.isObject(c)){return this.callParent(arguments)}var b;var a="get_"+c;if(typeof this[a]=="function"){b=this[a]()}else{b=this.callParent(arguments)}return b},afterEdit:function(b){b=b||[];this.isNATValid=false;this.natUpdateDirty();if(b.length>0){var c=b[0];var a="set_"+c;if(typeof this[a]=="function"){if(Ext.Array.contains(this.skipFieldSetters,c)){Ext.Array.remove(this.skipFieldSetters,c)}else{Ext.callback(this[a],this,[this.get(c)],1)}}}this.callStore("afterEdit",b)},natUpdateDirty:function(){var a=false;if(this.dirty){a=true}if(!a){for(var c=0;c<this.associations.length;c++){var b=this.associations.items[c];if(b.IsChanged(this)){a=true;break}}}if(this.isNATDirty!=a){this.isNATDirty=a;this.callStore("OnModelDirtyChanged",this)}},Merge:function(c){this.set(c.data);for(var b=0;b<this.associations.length;b++){var a=this.associations.items[b];a.Merge(this,c)}},IsNew:function(){return this.getId()==""},reject:function(b){var e=this,c=e.modified,f;for(f in c){if(c.hasOwnProperty(f)){if(typeof c[f]!="function"){e[e.persistenceProperty][f]=c[f]}}}e.dirty=false;e.editing=false;e.modified={};for(var d=0;d<this.associations.length;d++){var a=this.associations.items[d];a.reject(this,b)}this.natUpdateDirty();if(b!==true){e.afterReject()}},commit:function(b){var d=this;d.phantom=d.dirty=d.editing=false;d.modified={};for(var c=0;c<this.associations.length;c++){var a=this.associations.items[c];a.commit(this,b)}this.natUpdateDirty();if(b!==true){d.afterCommit()}},ValidateField:function(j,m,o){var n=Ext.isString(j)?j:j.name;var l=this.errors.getByField(n);for(var g=0;l.length>g;g++){this.errors.remove(l[g])}var b=Ext.Array.filter(this.validations,function(f){return(f.field===n)},this),d=Ext.data.validations,k=this.get(n);for(var e=0;b.length>e;e++){var c=b[e];var a=d[c.type](c,k);if(!a){this.errors.add({field:n,message:c.message||d.getMessage(c)||d[c.type+"Message"]})}}l=this.errors.getByField(n);if(l.length>0){Ext.callback(m,o,[l,null],0);return}var h=n+"_validator";if(typeof this[h]=="function"){this[h](null,function(f,i){if(f){this.errors.add({field:n,message:f});Ext.callback(m,o,[f,null],0)}else{Ext.callback(m,o,[null,null],0)}},this)}else{Ext.callback(m,o,[null,null],0)}},ValidateModel:function(d,c,a){this.errors.removeAll();var b=this;async.forEachSeries(b.fields.items,function(f,e){b.ValidateField(f,function(g,h){e(null,null)},b)},function(e){if(b.errors.isValid()){b.isNATValid=true;Ext.callback(c,a,[null,null],0)}else{b.isNATValid=false;Ext.callback(c,a,[b.errors,null],0)}})},GetFieldInfo:function(b){for(var a=0;a<this.fieldInfos.length;a++){if(this.fieldInfos[a].name==b){return this.fieldInfos[a]}}return null}});Ext.define("NAT.data.PersistentModel",{extend:"NAT.data.Model",fields:[{name:"created",type:"date"},{name:"modified",type:"date"},{name:"version",type:"int"},{name:"deleted",type:"boolean"}],fieldsInfo:[],constructor:function(b,c,a){this.callParent(arguments)}});Ext.define("NAT.data.RequestModel",{extend:"NAT.data.Model",fields:[],fieldsInfo:[],constructor:function(b,c,a){this.callParent(arguments)}});Ext.define("NAT.data.ClientModel",{extend:"NAT.data.Model",fields:[],fieldsInfo:[],constructor:function(b,c,a){this.callParent(arguments)}});Ext.define("NAT.data.proxy.Ajax",{extend:"Ext.data.proxy.Ajax",alias:"widget.natajaxproxy",requires:["NAT.view.MessageDialog"],mergeClientRecords:true,constructor:function(b){var a={type:"ajax",model:"NAT.data.Model",batchActions:false,reader:{type:"json",root:"data",messageProperty:"message",extractData:function(m){var l=this,f=[],d=l.model,c=m.length,g,e,j,h;if(!m.length&&Ext.isObject(m)){m=[m];c=1}for(h=0;h<c;h++){e=m[h];if(e._type){var k=app.getModuleClassName(e._type,"model");if(l.model.$className!=k){this.setModel(k)}}j=new l.model(undefined,l.getId(e),e,g={});j.phantom=false;l.convertRecordData(g,e,j);f.push(j);if(l.implicitIncludes){l.readAssociated(j,e)}}return f},readAssociated:function(d,j){var g=d.associations.items,f=0,h=g.length,c,e;for(;f<h;f++){c=g[f];e=j[c.name];if(e){c.read(d,e)}}}},writer:{type:"json",encode:false,listful:true,writeAllFields:true,getRecordData:function(h){var n=h.phantom===true,d=this.writeAllFields||n,e=this.nameProperty,i=h.fields,p=i.items,g={},m=h.clientIdProperty,l,c,k,o,j,q;if(d){q=p.length;for(j=0;j<q;j++){k=p[j];if(k.persist){c=k[e]||k.name;g[c]=h.get(k.name);if(k.dateFormat&&Ext.isDate(g[c])){g[c]=Ext.Date.format(g[c],k.dateFormat)}else{if((k.type)&&(k.type.type=="date")){if(g[c]!=null){g[c]=g[c].toJSON()}else{g[c]=null}}}}}}else{l=h.getChanges();for(o in l){if(l.hasOwnProperty(o)){k=i.get(o);c=k[e]||k.name;g[c]=l[o]}}}if(n){if(m&&operation&&operation.records.length>1){g[m]=h.internalId}}else{g[h.idProperty]=h.getId()}this.writeAssociated(h,g);return g},writeAssociated:function(d,j){var g=d.associations.items,f=0,h=g.length,c,e;for(;f<h;f++){c=g[f];c.write(d,j)}}}};b=Ext.merge(a,b);this.callParent([b]);this.on("exception",this.this_exception,this);return this},NATRequest:function(a,d,b){var c=Ext.create("Ext.data.Request",{url:a.url||app.baseUrl+"request",method:a.method||"POST",timeout:this.timeout,params:a.params,jsonData:this.Serialize(a.jsonData),scope:this,callback:this.NATCreateRequestCallback(a,d,b),preventLoadingMask:a.preventLoadingMask});if(!a.preventLoadingMask){app.ShowLoadingMask()}Ext.Ajax.request(c);return c},Serialize:function(a){if(typeof a==="undefined"){return""}if(a.isModel){return this.SerializeModel(a)}if(Ext.isArray(a)){return this.SerializeArray(a)}if(Ext.isObject(a)){return this.SerializeObject(a)}if(Ext.isBoolean(a)){return a}return this.SerializePrimitive(a)},SerializeObject:function(a){for(var c in a){if(!a.hasOwnProperty(c)){continue}var b=a[c];a[c]=this.Serialize(b)}return JSON.stringify(a)},SerializeModel:function(a){return this.getWriter().getRecordData(a)},SerializePrimitive:function(a){if(typeof a.toJSON=="function"){return a.toJSON()}else{return a.toString()}},SerializeArray:function(b){var a=[];Ext.Array.every(b,function(c){a.push(this.Serialize(c));return true},this);return a},NATCreateRequestCallback:function(a,d,b){var c=this;return function(f,g,e){c.NATProcessResponse(g,f,e,d,b)}},NATProcessResponse:function(e,c,b,f,d){if(!c.preventLoadingMask){app.HideLoadingMask()}if(!e){this.fireEvent("exception",this,b,null);return}var a=Ext.decode(b.responseText);if(!a.success){b.result=a;this.fireEvent("exception",this,b,null);Ext.callback(f,d,[{message:"error"},a],0)}else{Ext.callback(f,d,[null,a],0)}},processResponse:function(g,a,c,b,f,h){var e=this,d,i;if(g===true){d=e.getReader();i=d.read(e.extractResponseData(b));if(i.success!==false){Ext.apply(a,{response:b,resultSet:i});if(this.mergeClientRecords){a.commitRecords(i.records)}a.setCompleted();a.setSuccessful()}else{a.setException(i.message);e.fireEvent("exception",this,b,a)}}else{e.setException(a,b);e.fireEvent("exception",this,b,a)}if(typeof f=="function"){f.call(h||e,a)}e.afterRequest(c,g)},this_exception:function(c,b,a,g){var f,d;if(!a){if(b.result){f=b.result.message;d="failure"}else{f=b.responseText;d="error"}}else{if(typeof a.error=="object"){f=a.error.statusText;d="error"}else{f=a.error;d="failure"}}var e=Ext.create("NAT.view.MessageDialog");e.ShowModal({type:d,msg:f})}});Ext.define("NAT.data.ModelStore",{extend:"Ext.util.Observable",alias:"widget.natmodelstore",requires:["NAT.data.proxy.Ajax","Ext.data.reader.Reader","Ext.data.writer.Writer"],callback:null,scope:null,currModel:null,proxy:null,autoLoad:false,loading:false,saving:false,constructor:function(a){a=a||{};Ext.applyIf(a,{api:{read:app.baseUrl+"data/readOne",create:app.baseUrl+"data/create",update:app.baseUrl+"data/update",destroy:app.baseUrl+"data/destroy"},mergeClientRecords:true});this.proxy=Ext.create("NAT.data.proxy.Ajax",a);this.callParent([a]);if(this.autoLoad){Ext.defer(this.Load,10,this)}return this},CreateModel:function(){var a=app.natCreateModel(this.currModel);this.SetModel(a)},SetModel:function(a){if(this.currModel===a){return}if(this.currModel){this.currModel.unjoin(this)}this.currModel=a;if(this.currModel){this.currModel.join(this);this.proxy.setModel(this.currModel.self)}this.OnCurrentModelChanged()},Load:function(c,d,b){this.callback=d;this.scope=b;if(this.Loading){Ext.callback(this.callback,this.scope,[null,null],0);return}this.loading=true;if(c){c.lastModified=new Date(0);c.model=this.getModelName()}else{c={};c.lastModified=this.currModel.get("modified");c.model=this.getModelName();c.id=this.currModel.getId()}var a=Ext.create("Ext.data.Operation",{action:"read"});this.proxy.read(a,this.LoadCompleted,this)},LoadCompleted:function(a){this.loading=false;if(a.success){var b=a.resultSet.records[0];if(b){if(this.hasModel()&&(this.currModel.getId()==b.getId())){this.currModel.Merge(b);this.currModel.set("loaded",true);this.currModel.commit()}else{this.SetModel(b);this.currModel.set("loaded",true);this.currModel.commit()}}}this.fireEvent("LoadCompleted",a);Ext.callback(this.callback,this.scope,[null,null],0)},Save:function(d,c,b){this.callback=c;this.scope=b;if(this.Saving){Ext.callback(this.callback,this.scope,[null,null],0);return}this.saving=true;if((!this.currModel)||(!this.currModel.isNATDirty)){this.SaveCompleted({});return}var a=Ext.create("Ext.data.Operation",{records:[this.currModel],action:this.currModel.phantom?"create":"update",needsSync:true});this.proxy[a.action](a,this.onProxyWrite,this)},SaveCompleted:function(a){this.saving=false;this.fireEvent("SaveCompleted",a);Ext.callback(this.callback,this.scope,[null,a],0)},onProxyWrite:function(b){var c=this,d=b.wasSuccessful(),a=b.getRecords();switch(b.action){case"create":c.onCreateRecords(a,b,d);break;case"update":c.onUpdateRecords(a,b,d);break;case"destroy":c.onDestroyRecords(a,b,d);break}if(d){c.fireEvent("write",c,b);c.fireEvent("datachanged",c)}this.SaveCompleted(b)},onCreateRecords:function(c,b,e){if(!e){return}var a=c[0];var d=b.records[0];if(d){d.setId(a.getId())}},onUpdateRecords:function(b,a,c){},onDestroyRecords:function(b,a,c){if(!c){return}this.removed=[]},Merge:function(a){this.currModel.Merge(a.currModel)},reject:function(a){if(!this.hasModel()){return}this.currModel.reject(a)},commit:function(a){if(!this.hasModel()){return}this.currModel.commit(a)},IsChanged:function(){return(this.currModel)&&(this.currModel.isNATDirty)},getModel:function(){if(this.hasModel()){return this.currModel}else{return null}},hasModel:function(){return((this.currModel)&&(typeof this.currModel=="object")&&(!this.currModel.removed))},afterEdit:function(a,b){this.fireEvent("update",this,a,Ext.data.Model.EDIT,b)},OnModelDirtyChanged:function(a){this.fireEvent("modeldirtychanged",a)},OnCurrentModelChanged:function(){this.fireEvent("currentmodelchanged",this.currModel)}});Ext.define("NAT.data.Store",{extend:"Ext.data.Store",alias:"widget.natstore",requires:["NAT.data.proxy.Ajax"],lastParams:{},constructor:function(a){a=a||{};Ext.applyIf(a,{model:"NAT.data.Model",api:{read:app.baseUrl+"data/read",create:app.baseUrl+"data/create",update:app.baseUrl+"data/update",destroy:app.baseUrl+"data/destroy"},mergeClientRecords:false});this.proxy=Ext.create("NAT.data.proxy.Ajax",a);this.callParent([a]);a.params=a.params||{};var b={lastModified:new Date(0),collection:this.collection};this.lastParams=Ext.merge(b,a.params);this.on("datachanged",this.onDataChanged,this);return this},getNewRecords:function(){return this.data.filterBy(this.filterNew).items},getUpdatedRecords:function(){return this.data.filterBy(this.filterUpdated).items},getNewRecordsAll:function(){return this.data.filterBy(this.filterNewAll).items},getUpdatedRecordsAll:function(){return this.data.filterBy(this.filterUpdatedAll).items},onDataChanged:function(){this.updateCurrModel()},onProxyLoad:function(b){var d=this,e=b.wasSuccessful(),a=b.getRecords();d.loading=false;if(e){for(var c=0;c<a.length;c++){a[c].join(d)}}d.fireEvent("read",d,a,e,b);d.fireEvent("load",d,a,e,b);Ext.callback(b.callback,b.scope||d,[a,b,e])},onCreateRecords:function(c,b,g){if(!g){return}var f=b.resultSet.records;for(var e=0;e<f.length;++e){var a=f[e];var d=b.records[e];if(d){d.setId(a.getId())}}},onUpdateRecords:function(b,a,c){},onDestroyRecords:function(b,a,c){if(c){this.removed=[]}},Merge:function(e){var f=[],d=this.getCount();for(var c=0;c<d;c++){var b=this.getAt(c);if(!e.getById(b.getId())){f.push(b)}}for(var a=0;a<f.length;a++){this.remove(f[a])}this.MergeModels(e.getRange(0))},reject:function(b){var e=this.getRemovedRecords();for(d=0;d<e.length;d++){c=e[d];this.add(c)}var f=this.getUpdatedRecordsAll();for(var d=0;d<f.length;d++){var c=f[d];c.reject(b)}var a=this.getNewRecordsAll();for(d=0;d<a.length;d++){c=a[d];this.remove(c)}this.commit()},commit:function(a){this.removed=[];var e=this.GetChangedModelsAll();var d=e.length;for(var c=0;c<d;c++){var b=e[c];b.commit(a)}},ProcessResponse:function(f,a,e){if(!e){return}this.MergeModels(f);for(var d=0;d<f.length;d++){var c=f[d];var b=c.get("modified");if(b>this.lastParams.lastModified){this.lastParams.lastModified=b}}},MergeModels:function(b){for(var a=0;a<b.length;a++){this.MergeModel(b[a])}},MergeModel:function(b){var a=b.get("deleted");var c=this.getById(b.getId());if(a){if(c){this.deleteRecord(c)}return true}if(!c){this.add(b);return true}c.beginEdit();c.Merge(b);c.endEdit(true);c.commit();return true},deleteRecord:function(a){var b=this.data.indexOf(a);if(this.snapshot){this.snapshot.remove(a)}a.unjoin(this);this.data.remove(a);this.remove(a);this.fireEvent("remove",this,a,b);this.fireEvent("datachanged",this)},updateCurrModel:function(){if(this.currModel){return}this.Select(this.getAt(0))}});Ext.define("NAT.data.TreeStore",{extend:"Ext.data.TreeStore",alias:"widget.nattreestore",requires:["NAT.data.proxy.Ajax"],lastParams:{},constructor:function(a){a=a||{};Ext.applyIf(a,{model:"NAT.data.Model",api:{read:app.baseUrl+"data/read",create:app.baseUrl+"data/create",update:app.baseUrl+"data/update",destroy:app.baseUrl+"data/destroy"},mergeClientRecords:false});this.proxy=Ext.create("NAT.data.proxy.Ajax",a);a.sortOnLoad=false;this.callParent([a]);a.params=a.params||{};var b={lastModified:new Date(0),collection:this.collection};this.lastParams=Ext.merge(b,a.params);this.on("move",this.OnMove,this);this.on("datachanged",this.onDataChanged,this);return this},getNewRecords:function(){return Ext.Array.filter(this.tree.flatten(),this.filterNew)},getUpdatedRecords:function(){return Ext.Array.filter(this.tree.flatten(),this.filterUpdated)},getNewRecordsAll:function(){return Ext.Array.filter(this.tree.flatten(),this.filterNewAll)},getUpdatedRecordsAll:function(){return Ext.Array.filter(this.tree.flatten(),this.filterUpdatedAll)},onDataChanged:function(){this.updateCurrModel()},onProxyLoad:function(b){var c=this,d=b.wasSuccessful(),a=b.getRecords();c.loading=false;if(d){}c.fireEvent("read",c,a,d,b);c.fireEvent("load",c,a,d,b);Ext.callback(b.callback,b.scope||c,[a,b,d])},onCreateRecords:function(c,b,g){if(!g){return}var f=b.resultSet.records;for(var e=0;e<f.length;++e){var a=f[e];var d=b.records[e];if(d){this.tree.unregisterNode(d,false);d.setId(a.getId());this.tree.registerNode(d,false)}}},onUpdateRecords:function(b,a,c){},onDestroyRecords:function(b,a,c){if(c){this.removed=[]}},remove:function(a){if(!a.parentNode){return}a.parentNode.removeChild(a)},reject:function(a){var e=this.GetChangedModelsAll();var d=e.length;for(var c=0;c<d;c++){var b=e[c];if(b.get("loaded")){b.reject(a)}else{b.isReplace=true;b.parentNode.removeChild(b);b.isReplace=false}}this.commit()},commit:function(a){var e=this.GetChangedModelsAll();var d=e.length;for(var c=0;c<d;c++){var b=e[c];b.commit(a)}},ProcessResponse:function(g,a,f){if(!f){return}var e=this.lastParams.lastModified.getTime()==new Date(0).getTime();if(e){this.BuildStore(g)}else{this.MergeModels(g)}for(var d=0;d<g.length;d++){var c=g[d];var b=c.get("modified");if(b>this.lastParams.lastModified){this.lastParams.lastModified=b}}},BuildStore:function(c){var a=this.GetChildByParentId(c,"");if(a.length!=1){return}var b=a[0];b.beginEdit();b.set("loaded",true);this.setRootNode(b);b.endEdit(true);b.commit();this.BuildStoreReq(c,b);this.builded=true},BuildStoreReq:function(e,a){var c=this.GetChildByParentId(e,a.getId());if(c.length==0){return}c.sort(function(g,f){return g.get("index")-f.get("index")});for(var b=0;b<c.length;b++){var d=c[b];d.beginEdit();d.set("loaded",true);if(!d.get("deleted")){a.beginEdit();a.appendChild(d);a.endEdit(true);a.commit();this.BuildStoreReq(e,d)}d.endEdit(true);d.commit()}},GetChildByParentId:function(e,d){var a=[];for(var c=0;c<e.length;c++){var b=e[c];if(b.get("parentId")==d){a[a.length]=b}}return a},MergeModels:function(e){e.sort(function(g,f){return g.get("index")-f.get("index")});for(var d=0;d<e.length;d++){e[d].merged=false}var c=this.GetMergedModelsCount(e);while(c<e.length){for(d=0;d<e.length;d++){var b=e[d];if(b.merged){continue}if(this.MergeModel(b)){b.merged=true}}var a=this.GetMergedModelsCount(e);if(a==c){break}c=a}},GetMergedModelsCount:function(c){var a=0;for(var b=0;b<c.length;b++){if(c[b].merged){a+=1}}return a},MergeModel:function(e){var d=e.get("parentId"),f=e.get("index"),a=e.get("deleted");if(!d){var g=this.getRootNode();g.beginEdit();Ext.apply(e.data,{root:true,isFirst:true,isLast:true,depth:0,expanded:g.get("expanded"),loaded:true});g.Merge(e);g.endEdit(true);g.commit();return true}var h=this.tree.getNodeById(d);if(!h){return false}var i=h.getChildAt(f);var b=this.tree.getNodeById(e.getId());if(a){if(b){b.isReplace=true;b.parentNode.removeChild(b);b.isReplace=false}return true}if(!b){var c=Ext.data.NodeInterface.decorate(e);c.beginEdit();h.insertBefore(c,i);h.updateInfo(false);c.set("loaded",true);c.endEdit(true);c.commit();return true}if((b.get("parentId")==d)&&(b.get("index")==f)){b.beginEdit();Ext.apply(e.data,{root:false,isFirst:b.get("isFirst"),isLast:b.get("isLast"),depth:b.get("depth"),expanded:b.get("expanded"),loaded:true});b.Merge(e);b.endEdit(true);b.commit();return true}b.beginEdit();b.isReplace=true;b.parentNode.removeChild(b);b.isReplace=false;Ext.apply(e.data,{loaded:true});b.Merge(e);h.insertBefore(b,i);h.updateInfo(false);b.endEdit(true);b.commit();return true},OnMove:function(a,b,c){if(b!=c){b.updateInfo(false)}c.updateInfo(false)},updateCurrModel:function(){if(this.currModel){return}this.Select(this.getRootNode())}});Ext.define("NAT.data.StoreManager",{extend:"Ext.util.MixedCollection",alias:"widget.natstoremanager",constructor:function(a){this.callParent([a])},Init:function(){},Activate:function(b){var a=this.getByKey(b);a.active=true},Deactivate:function(b){var a=this.getByKey(b);a.active=false},Refresh:function(c,b,a){async.forEach(this.items,function(e,d){if(e.active){e.Load(null,d)}else{d(null,null)}},function(d,e){Ext.callback(b,a,[d,null],0)})}});
